# NodePulse 海外节点网络稳定性检测工具 PRD

# 一、产品概述

## 1.1 产品定位

NodePulse 是一款专为海外节点设计的网络稳定性检测工具，采用“轻量采集端+一体化核心服务端”的简化架构，聚焦跨境网络场景，通过Pulse Agent精准采集时延、丢包率、抖动等核心指标，经Pulse Core完成分析、展示、告警等功能，帮助运维团队实时掌握海外节点网络性能状态，快速定位问题根源，为网络优化提供数据支撑，保障海外业务稳定运行。

## 1.2 核心价值

- 精准感知：全面覆盖跨境网络核心性能指标，适配海外ICMP禁ping等特殊环境；

- 实时告警：分级预警机制，提前发现网络异常，避免故障扩大；

- 精准归因：快速区分问题类型，降低排查成本；

- 数据驱动：通过历史统计与多维度对比，为网络优化提供可落地依据；

- 可观测性集成：支持Prometheus Metrics接口，Agent可独立暴露指标供Prometheus抓取，Core支持与Prometheus-Stack联动，适配多样化运维监控体系。

## 1.3 品牌配套

Slogan：NodePulse - Beat of Overseas Network Stability（节点脉搏 - 海外网络稳定性的心跳）；

核心模块命名：采集端（Pulse Agent，独立组件）、核心服务端（Pulse Core，一体化组件，包含分析引擎、告警服务、可视化仪表盘、配置管理功能）。

# 二、目标用户与使用场景

## 2.1 目标用户

- 海外运维工程师：负责海外节点日常监控、异常排查、网络优化；

- 网络优化专员：基于工具数据制定跨境链路优化方案；

- 运维管理人员：掌握海外节点整体性能态势，评估网络质量。

## 2.2 核心使用场景

- 日常巡检：定时监测海外各地区节点的网络连通性与稳定性，生成健康报告；

- 异常排查：节点出现业务卡顿/断连时，通过工具定位问题根源（跨境链路/节点本地/运营商）；

- 优化评估：对比不同地区/运营商节点性能，评估网络优化方案效果；

- 应急响应：节点突发网络故障时，接收实时告警并快速开展故障处置。

# 三、核心目标

1. 指标全覆盖：基于双组件架构，精准采集时延、丢包率、抖动等核心网络指标，适配海外ICMP禁ping等特殊跨境环境；

2. 实时性保障：依托轻量采集与一体化核心服务协同，秒级呈现节点实时性能状态，异常告警延迟≤30秒；

3. 问题易定位：通过主动+被动双探测结合的分析能力，快速区分节点本地/跨境链路/运营商问题，缩短排查时间；

4. 运维轻量化：支持双组件快速部署（Agent一键安装、Core容器化部署）与批量节点管理，降低海外运维成本。

# 四、核心功能需求（简化架构：Pulse Agent+Pulse Core双组件）

## 4.1 组件一：Pulse Agent（轻量采集端）

### 4.1.1 基础能力

- 跨平台适配：支持Linux（CentOS、Ubuntu）、Windows Server等海外常用操作系统；

- 轻量化部署：CPU占用≤5%，内存占用≤100M，无额外依赖，支持一键安装/卸载；

- 数据加密：采集数据采用AES加密传输，保障跨境数据传输安全；

- 独立运行能力：支持不依赖Pulse Core独立运行，核心指标可通过Prometheus Metrics接口暴露，适配轻量化运维场景。

### 4.1.2 指标采集

- 时延类：采集往返RTT、单程时延、网络抖动、时延方差；

- 丢包类：采集ICMP/TCP/UDP丢包率、分片丢包率、链路丢包节点；

- 辅助类：采集路由跳数、上行/下行带宽、TCP建联耗时、DNS解析时延；

- 业务关联：支持被动抓包分析实际业务流量的性能指标，避免探测与业务脱节。说明：被动探测核心是“监听真实业务流量”，而非主动发送数据包，可理解为“流量观察者”——通过轻量抓包工具捕获节点上真实业务交互的网络数据包（如用户访问海外节点服务的HTTP/HTTPS流量），从实际流量中解析性能指标，确保检测结果与业务体验一致。

### 4.1.3 Prometheus Metrics接口支持（Agent核心扩展能力）

- 接口暴露：Agent默认开启Prometheus Metrics接口（默认端口9091，可配置），支持Prometheus标准抓取协议（HTTP/HTTPS），无需依赖Pulse Core即可独立提供指标数据；

- 指标覆盖：暴露指标需完整覆盖核心网络性能与Agent运行状态，具体指标体系见独立章节“核心指标体系设计”；

配置灵活性：支持通过Agent配置文件开启/关闭Metrics接口、自定义端口（1024-65535）、配置接口访问IP白名单（仅允许Prometheus服务器IP抓取，保障安全）；

标签附加：所有暴露指标均附加统一标签，确保多维度筛选聚合能力，具体标签信息见核心指标体系设计章节。

### 4.1.4 探测方式

- 主动探测：内置ping、mtr、traceroute、iperf3核心能力，支持ICMP禁ping适配（默认启用TCP 80/443/UDP自定义端口探测）；

- 探测参数可配置：数据包大小（64/128/512字节可选）、探测超时时间（1-30秒可配）；

- 被动监控：支持对节点业务端口（如80、443、自定义业务端口）的流量进行实时抓包分析，具体实现机制如下：

### 4.1.5 被动探测实现机制详解

1. 触发逻辑：接收Pulse Core下发的需监控业务端口列表（如电商业务的8080端口、支付业务的443端口），仅捕获指定端口的进出流量，不抓取全量流量（减少资源占用）。

2. 抓包实现：集成轻量抓包库（如Linux下的libpcap、Windows下的WinPcap），以“低功耗模式”运行，CPU占用≤2%，避免影响节点正常业务运行。

3. 指标解析：从捕获的TCP/UDP数据包中提取关键性能指标，核心包括：TCP层面：三次握手耗时（反映连接建立速度）、重传率（数据包丢失后重新发送的比例，直接关联业务卡顿）、滑动窗口大小（影响数据传输效率）；

4. 业务层面：单请求往返耗时（从客户端发请求到接收响应的总时间）、上行/下行吞吐量（单位时间内传输的业务数据量）；

5. 数据流转：解析后的被动探测指标，与主动探测数据一同加密压缩后上传至Pulse Core，供后续关联分析（如“主动探测时延正常，但被动探测重传率高”，可定位为业务层而非网络层问题）。

### 4.1.6 探测策略执行

- 定时探测：接收Core下发的自定义周期（1/5/10/30分钟等，默认5分钟一次），自动执行探测；

- 手动探测：响应Core下发的单节点/批量节点按需探测指令；

- 分组探测：按Core配置的“节点地区/运营商/业务类型”分组规则，执行批量探测；

- 并发控制：遵循Core配置的并发探测数量限制，避免对节点网络造成压力。

配置灵活性：支持通过Agent配置文件开启/关闭Metrics接口、自定义端口（1024-65535）、配置接口访问IP白名单（仅允许Prometheus服务器IP抓取，保障安全）；

标签附加：所有暴露指标均附加统一标签，确保多维度筛选聚合能力，具体标签信息见核心指标体系设计章节。

### 4.1.4 探测方式

- 主动探测：内置ping、mtr、traceroute、iperf3核心能力，支持ICMP禁ping适配（默认启用TCP 80/443/UDP自定义端口探测）；

- 探测参数可配置：数据包大小（64/128/512字节可选）、探测超时时间（1-30秒可配）；

- 被动监控：支持对节点业务端口（如80、443、自定义业务端口）的流量进行实时抓包分析，具体实现机制如下：

### 4.1.5 被动探测实现机制详解

1. 触发逻辑：接收Pulse Core下发的需监控业务端口列表（如电商业务的8080端口、支付业务的443端口），仅捕获指定端口的进出流量，不抓取全量流量（减少资源占用）。

2. 抓包实现：集成轻量抓包库（如Linux下的libpcap、Windows下的WinPcap），以“低功耗模式”运行，CPU占用≤2%，避免影响节点正常业务运行。

3. 指标解析：从捕获的TCP/UDP数据包中提取关键性能指标，核心包括：TCP层面：三次握手耗时（反映连接建立速度）、重传率（数据包丢失后重新发送的比例，直接关联业务卡顿）、滑动窗口大小（影响数据传输效率）；

4. 业务层面：单请求往返耗时（从客户端发请求到接收响应的总时间）、上行/下行吞吐量（单位时间内传输的业务数据量）；

5. 数据流转：解析后的被动探测指标，与主动探测数据一同加密压缩后上传至Pulse Core，供后续关联分析（如“主动探测时延正常，但被动探测重传率高”，可定位为业务层而非网络层问题）。

### 4.1.6 探测策略执行

- 定时探测：接收Core下发的自定义周期（1/5/10/30分钟等，默认5分钟一次），自动执行探测；

- 手动探测：响应Core下发的单节点/批量节点按需探测指令；

- 分组探测：按Core配置的“节点地区/运营商/业务类型”分组规则，执行批量探测；

- 并发控制：遵循Core配置的并发探测数量限制，避免对节点网络造成压力。

配置灵活性：支持通过Agent配置文件开启/关闭Metrics接口、自定义端口（1024-65535）、配置接口访问IP白名单（仅允许Prometheus服务器IP抓取，保障安全）；

标签附加：所有暴露指标均附加统一标签，确保多维度筛选聚合能力，具体标签信息见核心指标体系设计章节。

## 4.2 组件二：Pulse Core（一体化核心服务端）

说明：整合分析、展示、告警、探测管理、节点配置等所有非采集功能，采用单体架构部署（支持后续集群扩展），核心接收Pulse Agent上传的探测数据并完成后续处理，降低部署与运维复杂度。

### 4.2.1 探测管理与指标分析

### 4.2.1.1 实时分析

- 秒级计算：实时汇总各节点采集指标，生成单节点/批量节点的实时性能数据；

- 健康状态判定：按指标阈值划分红（异常）、黄（预警）、绿（正常）三色状态，默认规则：

- 红色：丢包率>30%、RTT>1000ms、节点断连、业务端口不可达；

- 黄色：丢包率5%-30%、RTT 500-1000ms、抖动>100ms；

- 绿色：丢包率≤5%、RTT≤500ms、抖动≤100ms。

补充说明：主动探测vs被动探测核心区别- 主动探测：Agent模拟流量，验证“网络链路是否通畅”，适合判断基础网络问题（如跨境链路拥堵、节点断连）；- 被动探测：Agent监听真实业务流量，验证“业务体验是否正常”，适合发现“网络通但业务卡”的隐性问题（如业务端口过载、应用层重传）。两者结合可实现“全链路覆盖”。

### 4.2.1.2 历史分析

- 数据聚合：基于本地缓存的短期历史数据（7天内），按小时/天聚合数据，计算指标均值、峰值、中位数、波动率；

- 性能基线：基于7天正常运行数据生成各节点的性能基线，指标偏离基线±30%即触发预警；

- 多维度对比：支持地区排行、运营商排行、同节点不同时段对比、不同链路对比；

- 异常归因：自动区分问题类型：节点本地故障（如服务异常）、跨境链路问题（如国际出口拥堵）、运营商路由绕路、机房网络故障。

### 4.2.2 分级告警与轻自愈

### 4.2.2.1 告警触发规则

- 阈值告警：支持自定义各指标告警阈值（丢包率、时延、抖动等），用户可覆盖默认规则；

- 趋势预警：支持配置指标持续恶化规则（如时延每5分钟上涨≥100ms、丢包率每10分钟上升≥5%），提前触发预警；

- 告警抑制：同一节点同一类型异常，5分钟内不重复推送告警，避免告警风暴。

### 4.2.2.2 告警分级

- 严重（P0）：节点断连、丢包率>30%、业务核心端口不可达，需立即处置；

- 一般（P1）：时延/抖动超阈值、带宽利用率≥90%，需1小时内关注；

- 提醒（P2）：指标偏离基线、路由轻微绕路，需定期跟踪。

### 4.2.2.3 告警渠道与推送

- 支持渠道：邮件、钉钉/企业微信、Slack、短信，可按告警级别配置推送渠道（如P0级推送短信+邮件+Slack）；

- 推送内容：包含异常节点名称、IP、地区、异常指标（当前值/阈值）、问题类型、发生时间、处理建议；

- 告警记录：留存所有告警记录，支持按节点、时间、级别筛选查询，记录告警处理状态（未处理/处理中/已解决）。

### 4.2.2.4 轻自愈能力

- 支持配置简单故障的自动修复规则，如节点网络服务卡死时自动重启服务、端口监听异常时重新绑定端口；

- 自愈日志：记录自愈操作过程、结果，便于后续追溯。

### 4.2.3 可视化仪表盘与报表

### 4.2.3.1 实时仪表盘

- 全局视图：展示所有海外节点的健康状态分布、异常节点TOP5、核心指标均值；

- 单节点详情：展示单个节点的实时时延/丢包率/抖动数据、路由链路拓扑图、丢包节点定位；

- 筛选功能：支持按地区、运营商、业务类型、健康状态筛选节点。

### 4.2.3.2 报表功能

- 常规报表：生成日/周/月性能汇总报表，包含各节点指标统计、异常事件汇总、性能排行；

- 定制报表：支持用户按筛选条件（如特定地区、特定业务节点）生成专属报表；

- 导出功能：所有报表支持导出为CSV/Excel/PDF格式，支持定时推送报表至指定邮箱。

### 4.2.4 节点与配置管理

### 4.2.4.1 节点管理

- 节点信息管理：支持增删改查节点信息（IP、地区、运营商、业务类型、机房位置、负责人）；

- 标签分组：支持为节点添加自定义标签（如“欧美区”“电商业务”），实现灵活分组管理；

- 节点状态管理：支持启用/禁用节点探测，禁用节点不参与监控与告警。

### 4.2.4.2 配置管理

- 探测规则配置：统一配置探测频率、探测协议、数据包大小等参数，支持批量下发至指定节点/分组；

- 告警规则配置：支持自定义告警阈值、趋势预警规则、告警渠道，支持规则的导入/导出；

- 权限管理：分角色权限（管理员/操作员/查看员），管理员可配置所有参数，操作员可执行探测与告警处理，查看员仅可查看数据。

### 4.2.5 海外场景专属适配

- ICMP禁ping适配：向Agent下发TCP/UDP优先探测配置，规避海外机房ICMP禁用问题；

- 多视角探测：支持配置“国内电信/联通/移动”与“海外本地运营商”双视角探测规则，下发至Agent执行，精准区分跨境链路与节点本地问题；

- 跨境传输优化：支持Agent端数据压缩+断点续传配置，避免跨境网络波动导致的数据丢失；

- 本地化适配：支持多时区展示（自动适配节点所在时区）、中英双语切换，报表适配海外团队查看习惯。

- Prometheus集成能力：支持与Prometheus-Stack双向集成，核心包括：数据导入：可通过Prometheus API拉取Agent暴露的指标数据，统一汇总至Core存储，实现“Agent+Prometheus+Core”的全链路监控；

- 告警联动：支持将Core的异常判定结果推送至Prometheus Alertmanager，与现有告警体系联动；

- 指标导出：Core自身运行指标（如数据处理延迟、告警推送成功率）也支持通过Prometheus Metrics接口暴露，便于监控Core服务稳定性。

说明：整合分析、展示、告警、探测管理、节点配置等所有非采集功能，采用单体架构部署（支持后续集群扩展），核心接收Pulse Agent上传的探测数据并完成后续处理，降低部署与运维复杂度。

### 4.2.1 探测管理与指标分析

### 4.2.1.1 实时分析

- 秒级计算：实时汇总各节点采集指标，生成单节点/批量节点的实时性能数据；

- 健康状态判定：按指标阈值划分红（异常）、黄（预警）、绿（正常）三色状态，默认规则：

- 红色：丢包率>30%、RTT>1000ms、节点断连、业务端口不可达；

- 黄色：丢包率5%-30%、RTT 500-1000ms、抖动>100ms；

- 绿色：丢包率≤5%、RTT≤500ms、抖动≤100ms。

补充说明：主动探测vs被动探测核心区别- 主动探测：Agent模拟流量，验证“网络链路是否通畅”，适合判断基础网络问题（如跨境链路拥堵、节点断连）；- 被动探测：Agent监听真实业务流量，验证“业务体验是否正常”，适合发现“网络通但业务卡”的隐性问题（如业务端口过载、应用层重传）。两者结合可实现“全链路覆盖”。

### 4.2.1.2 历史分析

- 数据聚合：基于本地缓存的短期历史数据（7天内），按小时/天聚合数据，计算指标均值、峰值、中位数、波动率；

- 性能基线：基于7天正常运行数据生成各节点的性能基线，指标偏离基线±30%即触发预警；

- 多维度对比：支持地区排行、运营商排行、同节点不同时段对比、不同链路对比；

- 异常归因：自动区分问题类型：节点本地故障（如服务异常）、跨境链路问题（如国际出口拥堵）、运营商路由绕路、机房网络故障。

### 4.2.2 分级告警与轻自愈

### 4.2.2.1 告警触发规则

- 阈值告警：支持自定义各指标告警阈值（丢包率、时延、抖动等），用户可覆盖默认规则；

- 趋势预警：支持配置指标持续恶化规则（如时延每5分钟上涨≥100ms、丢包率每10分钟上升≥5%），提前触发预警；

- 告警抑制：同一节点同一类型异常，5分钟内不重复推送告警，避免告警风暴。

### 4.2.2.2 告警分级

- 严重（P0）：节点断连、丢包率>30%、业务核心端口不可达，需立即处置；

- 一般（P1）：时延/抖动超阈值、带宽利用率≥90%，需1小时内关注；

- 提醒（P2）：指标偏离基线、路由轻微绕路，需定期跟踪。

### 4.2.2.3 告警渠道与推送

- 支持渠道：邮件、钉钉/企业微信、Slack、短信，可按告警级别配置推送渠道（如P0级推送短信+邮件+Slack）；

- 推送内容：包含异常节点名称、IP、地区、异常指标（当前值/阈值）、问题类型、发生时间、处理建议；

- 告警记录：留存所有告警记录，支持按节点、时间、级别筛选查询，记录告警处理状态（未处理/处理中/已解决）。

### 4.2.2.4 轻自愈能力

- 支持配置简单故障的自动修复规则，如节点网络服务卡死时自动重启服务、端口监听异常时重新绑定端口；

- 自愈日志：记录自愈操作过程、结果，便于后续追溯。

### 4.2.3 可视化仪表盘与报表

### 4.2.3.1 实时仪表盘

- 全局视图：展示所有海外节点的健康状态分布、异常节点TOP5、核心指标均值；

- 单节点详情：展示单个节点的实时时延/丢包率/抖动数据、路由链路拓扑图、丢包节点定位；

- 筛选功能：支持按地区、运营商、业务类型、健康状态筛选节点。

### 4.2.3.2 报表功能

- 常规报表：生成日/周/月性能汇总报表，包含各节点指标统计、异常事件汇总、性能排行；

- 定制报表：支持用户按筛选条件（如特定地区、特定业务节点）生成专属报表；

- 导出功能：所有报表支持导出为CSV/Excel/PDF格式，支持定时推送报表至指定邮箱。

### 4.2.4 节点与配置管理

- 节点信息管理：支持增删改查节点信息（IP、地区、运营商、业务类型、机房位置、负责人）；

- 标签分组：支持为节点添加自定义标签（如“欧美区”“电商业务”），实现灵活分组管理；

- 节点状态管理：支持启用/禁用节点探测，禁用节点不参与监控与告警。

### 4.2.4.2 配置管理

- 探测规则配置：统一配置探测频率、探测协议、数据包大小等参数，支持批量下发至指定节点/分组；

- 告警规则配置：支持自定义告警阈值、趋势预警规则、告警渠道，支持规则的导入/导出；

- 权限管理：分角色权限（管理员/操作员/查看员），管理员可配置所有参数，操作员可执行探测与告警处理，查看员仅可查看数据。

### 4.2.5 海外场景专属适配

- ICMP禁ping适配：向Agent下发TCP/UDP优先探测配置，规避海外机房ICMP禁用问题；

- 多视角探测：支持配置“国内电信/联通/移动”与“海外本地运营商”双视角探测规则，下发至Agent执行，精准区分跨境链路与节点本地问题；

- 跨境传输优化：支持Agent端数据压缩+断点续传配置，避免跨境网络波动导致的数据丢失；

- 本地化适配：支持多时区展示（自动适配节点所在时区）、中英双语切换，报表适配海外团队查看习惯。

- Prometheus集成能力：支持与Prometheus-Stack双向集成，核心包括：数据导入：可通过Prometheus API拉取Agent暴露的指标数据，统一汇总至Core存储，实现“Agent+Prometheus+Core”的全链路监控；

- 告警联动：支持将Core的异常判定结果推送至Prometheus Alertmanager，与现有告警体系联动；

- 指标导出：Core自身运行指标（如数据处理延迟、告警推送成功率）也支持通过Prometheus Metrics接口暴露，便于监控Core服务稳定性。

说明：整合分析、展示、告警、探测管理、节点配置等所有非采集功能，采用单体架构部署（支持后续集群扩展），降低部署与运维复杂度。

- 主动探测：内置ping、mtr、traceroute、iperf3核心能力，支持ICMP禁ping适配（默认启用TCP 80/443/UDP自定义端口探测）；

- 探测参数可配置：数据包大小（64/128/512字节可选）、探测超时时间（1-30秒可配）；

- 被动监控：支持对节点业务端口（如80、443、自定义业务端口）的流量进行实时抓包分析，具体实现机制如下：

### 4.2.1.1 被动探测实现机制详解

1. 触发逻辑：Pulse Core统一配置需监控的业务端口列表（如电商业务的8080端口、支付业务的443端口），下发至Pulse Agent；Agent仅捕获这些指定端口的进出流量，不抓取全量流量（减少资源占用）。

2. 抓包实现：Agent集成轻量抓包库（如Linux下的libpcap、Windows下的WinPcap），以“低功耗模式”运行，CPU占用≤2%，避免影响节点正常业务运行。

3. 指标解析：从捕获的TCP/UDP数据包中提取关键性能指标，核心包括：
TCP层面：三次握手耗时（反映连接建立速度）、重传率（数据包丢失后重新发送的比例，直接关联业务卡顿）、滑动窗口大小（影响数据传输效率）；

4. 业务层面：单请求往返耗时（从客户端发请求到接收响应的总时间）、上行/下行吞吐量（单位时间内传输的业务数据量）；

5. 数据流转：解析后的被动探测指标，与主动探测数据一同加密压缩后上传至Pulse Core，供后续关联分析（如“主动探测时延正常，但被动探测重传率高”，可定位为业务层而非网络层问题）。

- 定时探测：支持1/5/10/30分钟等自定义周期，默认5分钟一次；

- 手动探测：支持单节点/批量节点的按需手动触发探测；

- 分组探测：支持按“节点地区/运营商/业务类型”创建分组，实现分组批量探测；

- 并发控制：支持配置并发探测数量，避免对节点网络造成压力。

- 秒级计算：实时汇总各节点采集指标，生成单节点/批量节点的实时性能数据；

- 健康状态判定：按指标阈值划分红（异常）、黄（预警）、绿（正常）三色状态，默认规则：


    - 红色：丢包率>30%、RTT>1000ms、节点断连、业务端口不可达；

    - 黄色：丢包率5%-30%、RTT 500-1000ms、抖动>100ms；

    - 绿色：丢包率≤5%、RTT≤500ms、抖动≤100ms。

    补充说明：主动探测vs被动探测核心区别- 主动探测：模拟流量，验证“网络链路是否通畅”，适合判断基础网络问题（如跨境链路拥堵、节点断连）；- 被动探测：监听真实业务流量，验证“业务体验是否正常”，适合发现“网络通但业务卡”的隐性问题（如业务端口过载、应用层重传）。两者结合可实现“全链路覆盖”。

- 数据聚合：基于本地缓存的短期历史数据（7天内），按小时/天聚合数据，计算指标均值、峰值、中位数、波动率；

- 性能基线：基于7天正常运行数据生成各节点的性能基线，指标偏离基线±30%即触发预警；

- 多维度对比：支持地区排行、运营商排行、同节点不同时段对比、不同链路对比；

- 异常归因：自动区分问题类型：节点本地故障（如服务异常）、跨境链路问题（如国际出口拥堵）、运营商路由绕路、机房网络故障。

- 阈值告警：支持自定义各指标告警阈值（丢包率、时延、抖动等），用户可覆盖默认规则；

- 趋势预警：支持配置指标持续恶化规则（如时延每5分钟上涨≥100ms、丢包率每10分钟上升≥5%），提前触发预警；

- 告警抑制：同一节点同一类型异常，5分钟内不重复推送告警，避免告警风暴。

### 4.4.2 告警分级

- 严重（P0）：节点断连、丢包率>30%、业务核心端口不可达，需立即处置；

- 一般（P1）：时延/抖动超阈值、带宽利用率≥90%，需1小时内关注；

- 提醒（P2）：指标偏离基线、路由轻微绕路，需定期跟踪。

### 4.4.3 告警渠道与推送

- 支持渠道：邮件、钉钉/企业微信、Slack、短信，可按告警级别配置推送渠道（如P0级推送短信+邮件+Slack）；

- 推送内容：包含异常节点名称、IP、地区、异常指标（当前值/阈值）、问题类型、发生时间、处理建议；

- 告警记录：留存所有告警记录，支持按节点、时间、级别筛选查询，记录告警处理状态（未处理/处理中/已解决）。

### 4.4.4 轻自愈能力

- 支持配置简单故障的自动修复规则，如节点网络服务卡死时自动重启服务、端口监听异常时重新绑定端口；

- 自愈日志：记录自愈操作过程、结果，便于后续追溯。

### 4.5.1 实时仪表盘

- 全局视图：展示所有海外节点的健康状态分布、异常节点TOP5、核心指标均值；

- 单节点详情：展示单个节点的实时时延/丢包率/抖动数据、路由链路拓扑图、丢包节点定位；

- 筛选功能：支持按地区、运营商、业务类型、健康状态筛选节点。

### 4.5.2 报表功能

- 常规报表：生成日/周/月性能汇总报表，包含各节点指标统计、异常事件汇总、性能排行；

- 定制报表：支持用户按筛选条件（如特定地区、特定业务节点）生成专属报表；

- 导出功能：所有报表支持导出为CSV/Excel/PDF格式，支持定时推送报表至指定邮箱。

### 4.6.1 节点管理

- 节点信息管理：支持增删改查节点信息（IP、地区、运营商、业务类型、机房位置、负责人）；

- 标签分组：支持为节点添加自定义标签（如“欧美区”“电商业务”），实现灵活分组管理；

- 节点状态管理：支持启用/禁用节点探测，禁用节点不参与监控与告警。

### 4.6.2 配置管理

- 探测规则配置：统一配置探测频率、探测协议、数据包大小等参数，支持批量下发至指定节点/分组；

- 告警规则配置：支持自定义告警阈值、趋势预警规则、告警渠道，支持规则的导入/导出；

- 权限管理：分角色权限（管理员/操作员/查看员），管理员可配置所有参数，操作员可执行探测与告警处理，查看员仅可查看数据。

- ICMP禁ping适配：默认优先使用TCP/UDP端口探测，规避海外机房ICMP禁用问题；

- 多视角探测：支持“国内电信/联通/移动”与“海外本地运营商”双视角探测，精准区分跨境链路与节点本地问题；

- 跨境传输优化：采集数据支持压缩+断点续传，避免跨境网络波动导致的数据丢失；

- 本地化适配：支持多时区展示（自动适配节点所在时区）、中英双语切换，报表适配海外团队查看习惯。

- Prometheus集成能力：支持与Prometheus-Stack双向集成，核心包括：数据导入：可通过Prometheus API拉取Agent暴露的指标数据，统一汇总至Core存储，实现“Agent+Prometheus+Core”的全链路监控；

- 告警联动：支持将Core的异常判定结果推送至Prometheus Alertmanager，与现有告警体系联动；

- 指标导出：Core自身运行指标（如数据处理延迟、告警推送成功率）也支持通过Prometheus Metrics接口暴露，便于监控Core服务稳定性。

# 五、核心指标体系设计

说明：本章节统一规范项目核心指标的定义、计算口径与暴露规则，所有指标均服务于网络稳定性检测、异常排查、性能优化等核心需求，同时适配Prometheus可观测性集成要求。

## 5.1 指标分类与统一设计

|指标类别|指标名称|指标含义|指标单位|Prometheus指标名|附加标签|数据来源|
|---|---|---|---|---|---|---|
|时延类指标|往返时延（RTT）|探测数据包从Agent发送到目标节点/链路，再返回Agent的总时间，反映网络传输延迟|秒（s）|node_pulse_rtt_seconds|node_ip：节点IP；node_region：节点地区；node_operator：运营商；probe_type：探测类型（active/passive）；probe_protocol：探测协议（icmp/tcp/udp）|主动探测（ping/mtr）、被动抓包|
||单程时延|探测数据包从Agent发送到目标节点的单向时间|秒（s）|node_pulse_one_way_delay_seconds||主动探测（iperf3）|
||网络抖动|连续多次RTT的差值波动范围，反映网络延迟稳定性|秒（s）|node_pulse_jitter_seconds||主动探测（ping/mtr）、被动抓包|
||TCP建联耗时|TCP三次握手完成的总时间，反映连接建立效率|秒（s）|node_pulse_tcp_handshake_seconds||主动探测（tcp探测）、被动抓包|
|丢包类指标|数据包丢包率|发送数据包中未被成功接收的比例，反映网络连通稳定性|百分比（%）|node_pulse_packet_loss_rate||主动探测（ping/mtr/traceroute）、被动抓包|
||分片丢包率|大尺寸数据包分片传输时，未被完整接收的分片比例|百分比（%）|node_pulse_fragment_loss_rate||主动探测（自定义大尺寸数据包）|
||TCP重传率|TCP传输中，因丢包等原因重新发送的数据包比例|百分比（%）|node_pulse_tcp_retransmission_rate||被动抓包（业务流量）|
|带宽与流量类指标|上行带宽利用率|节点上行带宽的实际占用比例|百分比（%）|node_pulse_upload_bandwidth_utilization||主动探测（iperf3）、被动抓包|
||下行带宽利用率|节点下行带宽的实际占用比例|百分比（%）|node_pulse_download_bandwidth_utilization||主动探测（iperf3）、被动抓包|
||上行吞吐量|单位时间内节点上行传输的业务数据量|字节/秒（B/s）|node_pulse_upload_throughput_bytes||被动抓包（业务流量）|
||下行吞吐量|单位时间内节点下行接收的业务数据量|字节/秒（B/s）|node_pulse_download_throughput_bytes||被动抓包（业务流量）|
|辅助网络指标|路由跳数|从Agent到目标节点的网络路由节点数量|个|node_pulse_route_hops_count||主动探测（traceroute/mtr）|
||DNS解析时延|域名解析请求从发送到接收响应的总时间|秒（s）|node_pulse_dns_resolve_seconds||主动探测（DNS查询）|
|Agent运行状态指标|Agent运行状态|标识Agent是否正常运行（1=正常，0=异常）|无（状态码）|node_pulse_agent_up||Agent本地监控|
||Agent CPU占用率|Agent进程占用节点CPU的比例|百分比（%）|node_pulse_agent_cpu_usage|node_ip：节点IP；node_region：节点地区；agent_version：Agent版本|Agent本地监控|
||Agent内存占用量|Agent进程占用节点内存的大小|字节（B）|node_pulse_agent_memory_usage_bytes||Agent本地监控|
||探测任务执行次数|Agent累计执行主动/被动探测任务的总次数|次|node_pulse_probe_total_count||Agent任务日志|
## 5.2 Prometheus指标暴露规则

- 暴露方式：Agent通过HTTP/HTTPS接口暴露指标，默认路径为/metrics，默认端口9091（可配置）；

- 数据类型：所有指标均采用Gauge类型（反映瞬时值），其中累计类指标（如探测任务执行次数）采用Counter类型；

- 更新频率：指标实时更新，更新周期与探测周期一致（1-30分钟可配），确保数据时效性；

- 安全控制：支持配置IP白名单，仅允许指定Prometheus服务器IP访问指标接口，避免未授权获取。

## 5.3 指标计算口径规范

- 时延类指标：取单次探测周期内10次采样的均值，精确到小数点后3位；

- 丢包率/利用率指标：计算方式为（丢失/占用数量÷总数量）×100，精确到小数点后1位；

- 抖动指标：取单次探测周期内10次RTT采样的标准差，精确到小数点后3位；

- 所有指标若探测失败（如节点断连），统一标记为-1，避免无效数据干扰。

# 六、非功能需求

## 6.1 性能要求

- 采集端性能：Pulse Agent运行时CPU占用≤5%，内存占用≤100M；

- 数据处理性能：支持≥1000个海外节点同时探测，单节点指标计算延迟≤1秒；

- 告警延迟：异常发生后，告警推送延迟≤30秒；

## 6.2 兼容性要求

- 操作系统兼容：采集端支持Linux（CentOS 7+、Ubuntu 18.04+）、Windows Server 2016+；

- 浏览器兼容：可视化仪表盘支持Chrome、Firefox、Edge最新版本；

- 运营商兼容：适配海外主流运营商（如AT&T、Verizon、沃达丰、软银等）的网络环境；

- 可观测性兼容：支持Prometheus v2.0+版本抓取协议，适配Prometheus-Stack（含Prometheus、Alertmanager、Grafana）主流部署架构。

## 6.3 安全性要求

- 数据安全：采集数据传输采用AES加密，存储数据采用加密存储，敏感信息（如节点IP、负责人信息）脱敏展示；

- 访问安全：支持账号密码+短信验证码登录，支持IP白名单限制访问，操作日志留存6个月；

- 漏洞防护：定期进行安全扫描，修复高危漏洞，避免被恶意攻击。

## 6.4 可扩展性要求

- 架构可扩展：核心服务端支持单体部署（初期简化运维），预留集群扩展能力（后续节点量增加时可横向扩容）；

- 功能可扩展：预留API接口，支持后续对接海外云厂商（AWS/Azure/GCP）节点、业务监控平台；

- 节点可扩展：支持节点数量横向扩展，新增节点可快速接入监控。

## 6.5 易用性要求

- 部署简单：采集端支持一键安装脚本，服务端支持Docker容器化部署；

- 操作直观：仪表盘布局清晰，核心指标一目了然，配置操作流程简单，减少运维学习成本；

- 帮助文档：提供详细的使用手册、常见问题解答（FAQ），包含海外场景适配的特殊操作说明。

## 5.1 性能要求

- 采集端性能：Pulse Agent运行时CPU占用≤5%，内存占用≤100M；

- 数据处理性能：支持≥1000个海外节点同时探测，单节点指标计算延迟≤1秒；

- 告警延迟：异常发生后，告警推送延迟≤30秒；

## 5.2 兼容性要求

- 操作系统兼容：采集端支持Linux（CentOS 7+、Ubuntu 18.04+）、Windows Server 2016+；

- 浏览器兼容：可视化仪表盘支持Chrome、Firefox、Edge最新版本；

- 运营商兼容：适配海外主流运营商（如AT&T、Verizon、沃达丰、软银等）的网络环境；

- 可观测性兼容：支持Prometheus v2.0+版本抓取协议，适配Prometheus-Stack（含Prometheus、Alertmanager、Grafana）主流部署架构。

## 5.3 安全性要求

- 数据安全：采集数据传输采用AES加密，存储数据采用加密存储，敏感信息（如节点IP、负责人信息）脱敏展示；

- 访问安全：支持账号密码+短信验证码登录，支持IP白名单限制访问，操作日志留存6个月；

- 漏洞防护：定期进行安全扫描，修复高危漏洞，避免被恶意攻击。

## 5.4 可扩展性要求

- 架构可扩展：核心服务端支持单体部署（初期简化运维），预留集群扩展能力（后续节点量增加时可横向扩容）；

- 功能可扩展：预留API接口，支持后续对接海外云厂商（AWS/Azure/GCP）节点、业务监控平台；

- 节点可扩展：支持节点数量横向扩展，新增节点可快速接入监控。

## 5.5 易用性要求

- 部署简单：采集端支持一键安装脚本，服务端支持Docker容器化部署；

- 操作直观：仪表盘布局清晰，核心指标一目了然，配置操作流程简单，减少运维学习成本；

- 帮助文档：提供详细的使用手册、常见问题解答（FAQ），包含海外场景适配的特殊操作说明。

# 七、数据需求

## 7.1 数据类型与存储周期

- 实时指标数据：留存7天，按分钟聚合；

- 告警记录：留存1年；

- 操作日志：留存6个月；

- 节点配置信息：长期留存，随节点信息更新同步更新；

- Prometheus暴露指标：Agent独立运行时，指标仅在本地缓存（留存1小时），供Prometheus实时抓取；接入Core后，指标同步至Core本地缓存，遵循实时指标数据存储周期；指标缓存与同步需严格遵循核心指标体系的计算口径与格式规范。

## 7.2 数据存储方案

- 配置数据与告警记录：采用MySQL/PostgreSQL存储，保障数据稳定性；

- 实时指标缓存：Core端采用本地缓存存储实时指标数据（留存7天），保障查询效率；

- 数据备份：支持定时备份（每日凌晨全量备份，每6小时增量备份），备份数据留存30天。

## 6.1 数据类型与存储周期

- 实时指标数据：留存7天，按分钟聚合；

- 告警记录：留存1年；

- 操作日志：留存6个月；

- 节点配置信息：长期留存，随节点信息更新同步更新；

- Prometheus暴露指标：Agent独立运行时，指标仅在本地缓存（留存1小时），供Prometheus实时抓取；接入Core后，指标同步至Core本地缓存，遵循实时指标数据存储周期；指标缓存与同步需严格遵循核心指标体系的计算口径与格式规范。

## 6.2 数据存储方案

- 配置数据与告警记录：采用MySQL/PostgreSQL存储，保障数据稳定性；

- 实时指标缓存：Core端采用本地缓存存储实时指标数据（留存7天），保障查询效率；

- 数据备份：支持定时备份（每日凌晨全量备份，每6小时增量备份），备份数据留存30天。

# 八、上线标准（MVP阶段）

1. 核心功能可用：Pulse Agent部署成功，支持TCP/UDP探测，精准采集时延、丢包率、抖动等核心指标（符合指标体系规范）；Prometheus Metrics接口正常暴露，指标格式、标签与计算口径符合要求，可被Prometheus成功抓取；

2. 分析能力达标：支持实时健康状态判定、7天性能基线生成、基础异常归因；

3. 告警功能正常：分级告警规则生效，支持邮件、Slack、企业微信推送，告警延迟≤30秒；

4. 可视化可用：实时仪表盘、基础报表生成与导出功能正常；

5. 性能达标：支持≥500个海外节点同时探测，采集端资源占用符合要求；

6. 兼容性达标：适配主流海外操作系统与运营商网络环境；

7. 安全达标：数据传输与存储加密，访问控制功能正常。

# 九、风险与应对

|风险类型|具体描述|应对措施|
|---|---|---|
|环境适配风险|海外部分机房禁用多种探测协议，导致探测失效|预留多协议探测方案，支持自定义探测端口，提供探测协议自动适配功能，检测到协议不可用时自动切换|
|数据传输风险|跨境网络波动导致采集数据丢失或延迟过高|采用数据压缩+断点续传机制，设置数据重传策略，本地缓存临时数据，网络恢复后同步至服务端|
|性能风险|节点数量增多后，服务端处理压力过大，导致延迟升高|核心服务端初期采用单体部署简化运维，预留集群扩展能力；优化数据聚合算法，减少不必要的计算开销；设置数据采样机制，高并发时保障核心指标计算优先|
|告警风暴风险|海外节点集中出现异常时，产生大量告警，干扰运维判断|启用告警抑制与聚合功能，同一类型异常按区域/分组聚合推送；设置告警优先级，优先推送严重级别告警|
|安全风险|安全风险<br>海外节点被攻击，导致采集端被篡改或数据泄露；Prometheus Metrics接口被未授权访问<br>加强采集端安全校验，定期更新安全补丁；采用双向认证机制，确保采集端与服务端合法通信；敏感数据脱敏存储与展示；为Metrics接口配置IP白名单，限制仅授权Prometheus服务器访问|加强采集端安全校验，定期更新安全补丁；采用双向认证机制，确保采集端与服务端合法通信；敏感数据脱敏存储与展示|
# 十、后续迭代方向

- 智能分析升级：引入AI算法，识别网络异常模式（如运营商割接、国际出口拥堵），提升归因精准度；

- 链路可视化升级：绘制跨境路由拓扑图，直观展示链路绕路、故障节点位置；

- 业务联动升级：对接业务监控平台，关联网络性能与业务可用性数据，实现根因定位闭环；

- 多云适配升级：兼容AWS/Azure/GCP等海外云厂商节点，适配云平台网络监控特性；

- 自愈能力升级：支持更复杂故障的自动修复，如链路切换、节点冗余切换；

- 可观测性深化：新增Prometheus指标可视化模板（Grafana Dashboard），模板字段与核心指标体系完全对齐，支持一键导入；优化Core与Prometheus的告警联动策略，实现跨系统告警闭环。
> （注：文档部分内容可能由 AI 生成）
